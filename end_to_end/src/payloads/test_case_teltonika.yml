type: tcp
message_type: hex
device_type: teltonika
nsq_check: true

test_case:
  - name: Teltonika FMB130 Unregistered device
    connections:
      - steps:
        - name: Login
          pre_test:
            - $template: delete_device
              args: ["${imei}"]
            - $template: reset_command_queue
              args: ["${imei}"]
          send: "000f${imei_hex}"
          expect_ack: 
            - "01"
            - "000000000000000e0c010500000006676574766572010000a4c2"
          nsq_check: []

        - name: Model identifier
          send: "000000000000009e0c0106000000965665723a30342e30302e30305f3133204750533a41584e5f352e312e392048773a464d42313330204d6f643a343520494d45493a33353337343233373239353030343820496e69743a323032352d31312d313020383a343920557074696d653a353239204d41433a333838413231373845303143205350433a312830292041584c3a32204f42443a3020424c3a312e31302042543a34010000953d"
          expect_ack: []
          db_check:
            - $template: db_check_device
              args: ["${imei}", "teltonika", "fmb130", 0, True, "${date_now}"]
          nsq_check: []

        - name: AVL packet target 0
          send: "000000000000006c8e010000019a6cfcd7c8004334551dfbaad4690018013f06000000000011000700ef0100f00100150500c800004501000101007160000700b5001700b6001500425f4700cd7de900ce3e990043101e0044002c000300f10000c74200c70000016200100002438200000000010000e857"
          expect_ack:
            - '00000001'
          db_check:
            - $template: db_check_device
              args: ["${imei}", "teltonika", "fmb130", 0, False, "${date_now}"]
          nsq_check: []

  - name: Teltonika Login target 0
    connections:
      - steps:
        - name: Login
          pre_test:
            - $template: insert_device
              args: ["${imei}", "teltonika", "fmb130", 0]
          send: "000f${imei_hex}"
          expect_ack: []
          nsq_check: []
          db_check:
            - $template: db_check_device
              args: ["${imei}", "teltonika", "fmb130", 0, false, ""]

  - name: New teltonika FM1200 registered device
    connections:
      - steps:
        - name: Login
          pre_test: 
            - $template: insert_device
              args: ["${imei}", None, None, "${target_nsq_debug}"]
          send: "000f${imei_hex}"
          expect_ack:
            - "01"
          nsq_check: []

      - name: AVL packet 1
        send: "00000000000003b5080b0000019a4a618b50013fae2f3efc4f81f6002e000013000042130701010200b3004501f000500415040909000ab50009b600064235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a619320013fae2f3efc4f81f6002e000013000042130701010200b3004501f000500415040909000ab50009b600064235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a619352013fae2f3efc4f81f6002e000013000042130701010200b3004501f000500415040909000ab50009b600064235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a61cdb8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a61e528013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a61fc98013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a620468013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a621fc0013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a622f60013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab5000ab600054235c8180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a623348013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50009b600054235c7180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a623730013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c8180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000b00003bd4"
        expect_ack:
          - '0000000b'
        nsq_check: []

      - name: AVL packet 2
        send: "00000000000003b5080b0000019a4a625288013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a626228013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c8180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a6269f8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a627d80013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62b818013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62bfe8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62cf88013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62d370013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62eae0013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62eec8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a630a20013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000b0000937f"
        expect_ack:
          - '0000000b'
        nsq_check: []

      - name: Model identifier
        send: "00000000000000940c01060000008c4657205665723a30312e30362e313520523020494d45493a3335373435343037353036323337302044657669636549443a30303030303920424c205665723a30342e3032204d6f64656d204657205665723a544d3131515f525f30312e30342e30372e30305f3030312048573a464d313230322e5265763078204e694d482c20362d333056205447313030300100003524"
        expect_ack:
          - '00000001'
        nsq_check: []

      - name: AVL packet 3
        send: "00000000000003b5080b0000019a4a6311f0013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c8180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a631222013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c7180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a631254013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c6180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a6315d8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c5180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a63160a013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c4180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a6319c0013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c3180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a634c88013fae2f3efc4f81f6002e000013000042130701010200b3004501f000500415040909000ab50008b600054235c2180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a635458013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c3180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a6363f8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c2180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a63642a013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c3180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a636bc8013fae2f3efc4f81f60039000014000042130701010200b3004501f000500415040909000ab50008b600054235c4180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000b00009041"
        expect_ack:
          - '00000001'
        nsq_check:
          - $template: nsq_data
            args: ["${imei}", "00000000000003b5080b0000019a4a618b50013fae2f3efc4f81f6002e000013000042130701010200b3004501f000500415040909000ab50009b600064235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a619320013fae2f3efc4f81f6002e000013000042130701010200b3004501f000500415040909000ab50009b600064235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a619352013fae2f3efc4f81f6002e000013000042130701010200b3004501f000500415040909000ab50009b600064235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a61cdb8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a61e528013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a61fc98013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a620468013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a621fc0013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a622f60013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab5000ab600054235c8180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a623348013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50009b600054235c7180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a623730013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c8180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000b00003bd4", "fmb130", "teltonika"]
          - $template: nsq_data
            args: ["${imei}", "00000000000003b5080b0000019a4a625288013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a626228013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c8180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a6269f8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a627d80013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62b818013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62bfe8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62cf88013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62d370013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62eae0013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a62eec8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235ca180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a630a20013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c9180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000b0000937f", "fmb130", "teltonika"]
          - $template: nsq_data
            args: ["${imei}", "00000000000003b5080b0000019a4a6311f0013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c8180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a631222013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c7180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a631254013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c6180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a6315d8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c5180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a63160a013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c4180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a6319c0013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c3180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a634c88013fae2f3efc4f81f6002e000013000042130701010200b3004501f000500415040909000ab50008b600054235c2180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a635458013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c3180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a6363f8013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c2180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a63642a013fae2f3efc4f81f6002e000014000042130701010200b3004501f000500415040909000ab50008b600054235c3180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000000019a4a636bc8013fae2f3efc4f81f60039000014000042130701010200b3004501f000500415040909000ab50008b600054235c4180000cd2a98ce0506430e3d4400000346000000ebc700000000f10000c742000b00009041", "fmb130", "teltonika"]

  - name: Teltonika FMB130 Registered device
    connections:
      - steps:
        - name: Login
          pre_test: 
            - $template: insert_device
              args: ["${imei}", "teltonika", "fmb130", "${target_nsq_debug}"]
          send: "000f${imei_hex}"
          expect_ack:
            - "01"
          nsq_check:
            - $template: nsq_data
              args: ["${imei}", "000f${imei_hex}", "fmb130", "teltonika"]

        - name: Location
          send: "000000000000006c8e010000019a6cfd35880043345146fbaad5950017014806000000000011000700ef0100f00100150500c800004501000101007160000700b5001700b6001400425f6100cd7de900ce3e990043101e0044002b000300f10000c74200c700000171001000024391000000000100002e2f"
          expect_ack: []
          nsq_check:
            - $template: nsq_connection_info_connect
              args: ["${imei}"]
            - $template: nsq_data
              args: ["${imei}", "000000000000006c8e010000019a6cfd35880043345146fbaad5950017014806000000000011000700ef0100f00100150500c800004501000101007160000700b5001700b6001400425f6100cd7de900ce3e990043101e0044002b000300f10000c74200c700000171001000024391000000000100002e2f", "fmb130", "teltonika"]
          db_check:
            - $template: db_check_device
              args: ["${imei}", "teltonika", "fmb130", "${target_nsq_debug}", true, "${date_now}"]

        - name: ICCID
          send: "00000000000000380c010600000030494d45493a203335333734323337323935303034382c20434349443a2038393632313030303937393036333134353738010000ce47"
          expect_ack:
            - ""
          db_check:
            - $template: db_check_device_iccid
              args: ["${imei}", "8962100097906314578", "${date_now}"]
          nsq_check:
            - $template: nsq_data
              args: ["${imei}", "00000000000000380c010600000030494d45493a203335333734323337323935303034382c20434349443a2038393632313030303937393036333134353738010000ce47", "fmb130", "teltonika"]

        - name: Location
          send: "000000000000006c8e010000019a6cfd5c9800433450b0fbaad8510017013306000000000011000700ef0100f00100150500c800004501000101007161000700b5001600b6001400425f7100cd7de900ce3e990043101f0044002b000300f10000c74200c700000171001000024391000000000100007797"
          expect_ack:
            - ""
          nsq_check:
            - $template: nsq_data
              args: ["${imei}", "000000000000006c8e010000019a6cfd35880043345146fbaad5950017014806000000000011000700ef0100f00100150500c800004501000101007160000700b5001700b6001400425f6100cd7de900ce3e990043101e0044002b000300f10000c74200c700000171001000024391000000000100002e2f", "fmb130", "teltonika"]
            - $template: nsq_connection_info_disconnect
              args: ["${imei}"]
          db_check:
            - $template: db_check_device
              args: ["${imei}", "teltonika", "fmb130", "${target_nsq_debug}", false, "${date_now}"]

  - name: Teltonika Buffer
    connections:
      - steps:
        - name: Login
          pre_test: 
            - $template: insert_device
              args: ["${imei}", "teltonika", "fmb130", "${target_nsq_debug}"]
          send: "000f${imei_hex}"
          expect_ack:
            - "01"
          nsq_check:
            - $template: nsq_data
              args: ["${imei}", "000f${imei_hex}", "fmb130", "teltonika"]

        - name: Location Buffer
          send: "00000000000004b38e0c000001997b78e6a8003fa4028efc59e3f9000a010612001d00000010000800ef0100f0010015050001010071640107012a38012a4400000500426d6700430fc80044000001470cf12a480c26000300f10000c742001001acf7fc01e30000315800000000000001997b790db8003fa3f190fc59e1d2000a010512000d00000010000800ef0100f0010015050001010071640107012a38012a4400000500426d6700430fcb0044000001470cf22a480c1c000300f10000c742001001acf82c01e30000315800000000000001997b7934c8003fa3e0b4fc59e0850007010511001300000010000800ef0100f0010015050001010071640107012a38012a4400000500426d8800430fcb0044000001470ce62a480c1c000300f10000c742001001acf85c01e30000315800000000000001997b795bd8003fa3cb16fc59de800004010710001b00000010000800ef0100f0010015050001010071640107012a38012a4400000500426d6a00430fc70044000001470ce62a480c1c000300f10000c742001001acf89a01e30000315800000000000001997b7982e8003fa3b694fc59dbc40005010611001200000010000800ef0100f0010015050001010071640107012a38012a4400000500426d6200430fcb0044000001470cf42a480c1c000300f10000c742001001acf8cf01e30000315800000000000001997b79a9f8003fa3a2dafc59d919000601080f001400000010000800ef0100f0010015050001010071640107012a38012a4400000500426d7900430fcb0044000001470ce62a480c1c000300f10000c742001001acf90d01e30000315800000000000001997b79d108003fa3996afc59d7890008010410000b00000010000800ef0100f0010015050001010071640107012a38012a4400000500426d9900430fcb0044000001470cdf2a480c1c000300f10000c742001001acf92801e30000315800000000000001997b79f818003fa38473fc59d5a6000b010b0f001c00000010000800ef0100f0010015050001010071640107012a38012a4400000500426dad00430fcb0044000001470ce22a480c1c000300f10000c742001001acf96301e30000315800000000000001997b7a1f28003fa36030fc59d595000b010a0f002700000010000800ef0100f0010015050001010071640107012a38012a4400000500426d8b00430fc90044000001470cdd2a480c1c000300f10000c742001001acf9ca01e30000315800000000000001997b7a4638003fa33836fc59d211000b010711002d00000010000800ef0100f0010015050001010071640107012a38012a4400000500426d9700430fcb0044000001470cd42a480c1c000300f10000c742001001acfa3c01e30000315800000000000001997b7a6d48003fa30348fc59cc67000d010810003400000010000800ef0100f0010015050001010071640107012a38012a4400000500426db100430fcb0044000001470ccf2a480c1c000300f10000c742001001acfac501e30000315800000000000001997b7a9458003fa2d479fc59c721000d010811003600000010000800ef0100f0010015050001010071640107012a38012a4400000500426dbf00430fcb0044000001470cc62a480c1c000300f10000c742001001acfb5801e300003158000000000c00008751"
          expect_ack: []
          nsq_check:
            - $template: nsq_connection_info_connect
              args: ["${imei}"]
            - $template: nsq_data
              args: ["${imei}", "", "fmb130", "teltonika"]
          db_check:
            - $template: db_check_device
              args: ["${imei}", "teltonika", "fmb130", "${target_nsq_debug}", true, "${date_now}"]

        - name: Location Buffer 2
          send: "00000000000004b38e0c000001997b7abb68003fa297dcfc59c0e1000e010911003a00000010000800ef0100f0010015040001010071640107012a38012a4400000500426db000430fcb0044000001470ccf2a480c1c000300f10000c742001001acfbf401e30000315800000000000001997b7ae278003fa25d33fc59bc52000c010b10003d00000010000800ef0100f0010015040001010071640107012a38012a4400000500426daf00430fcb0044000001470cc62a480c1c000300f10000c742001001acfc9a01e30000315800000000000001997b7b0988003fa224f4fc59bae4000c010c11003d00000010000800ef0100f0010015040001010071640107012a38012a4400000500426db500430fca0044000001470cc12a480c1c000300f10000c742001001acfd4a01e30000315800000000000001997b7b3098003fa1e1d4fc59ba3d000a010e11003e00000010000800ef0100f0010015050001010071640107012a38012a4400000500426dc000430fcb0044000001470ca82a480c1c000300f10000c742001001acfe0801e30000315800000000000001997b7b57a8003fa1aa09fc59bbcd000a010f11004000000010000800ef0100f0010015050001010071640107012a38012a4400000500426da500430fca00440000014700002a480c1c000300f10000c742001001acfea601e30000313300000000000001997b7b7eb8003fa16bccfc59bcd8000a011011003e00000010000800ef0100f0010015050001010071640107012a38012a4400000500426dbd00430fcb0044000001470cce2a480c1c000300f10000c742001001acff5701e30000313300000000000001997b7ba5c8003fa12dc0fc59bfa4000c011011003f00000010000800ef0100f0010015050001010071640107012a38012a4400000500426dc200430fcb0044000001470cbe2a480c1c000300f10000c742001001ad000601e30000315800000000000001997b7bccd8003fa0f155fc59c1a9000d010f11003b00000010000800ef0100f0010015050001010071640107012a38012a4400000500426d6100430fcb00440000014700002a480c1c000300f10000c742001001ad00b201e30000313300000000000001997b7bf3e8003fa0b743fc59c339000b010f10003d00000010000800ef0100f0010015050001010071640107012a38012a44000005004266c200430fcb0044000001470c982a480c1c000300f10000c742001001ad015601e30000315800000000000001997b7c1af8003fa07f46fc59c4120008010f10003500000010000800ef0100f0010015050001010071640107012a38012a4400000500426d1400430fc80044000001470cbc2a480c1c000300f10000c742001001ad01f501e30000315800000000000001997b7c4208003fa04a57fc59c6380006010f10003600000010000800ef0100f0010015050001010071640107012a38012a4400000500426da800430fcb0044000001470cc42a480c1c000300f10000c742001001ad028a01e30000315800000000000001997b7c6918003fa011c4fc59cb1a0006011610003100000010000800ef0100f0010015050001010071640107012a38012a4400000500426d9000430fc80044000001470d0d2a480c1c000300f10000c742001001ad032b01e300003158000000000c00007bda"
          expect_ack: []
          nsq_check:
            - $template: nsq_connection_info_connect
              args: ["${imei}"]
            - $template: nsq_data
              args: ["${imei}", "", "fmb130", "teltonika"]
          db_check:
            - $template: db_check_device
              args: ["${imei}", "teltonika", "fmb130", "${target_nsq_debug}", true, "${date_now}"]

  - name: Teltonika FMB130 Online command
    connections:
      - steps:
        - name: Login
          block: true
          pre_test: 
            - $template: insert_device
              args: ["${imei}", "teltonika", "fmb130", "${target_nsq_debug}"]
            - $template: reset_command_queue
              args: ["${imei}"]
          send: "000f${imei_hex}"
          expect_ack:
            - "01"
          nsq_check:
            - $template: nsq_data
              args: ["${imei}", "000f${imei_hex}", "teltonika", "fmb130"]

        - name: Location
          block: true
          send: "00000000000000678e01000001997b9d3788003f8ccc90fc4a2de7001c01060d004300000010000800ef0100f0010015050001010071640107012a38012a4400000500426dc300430fcb0044000001470c0a2a480c1c000300f10000c742001001ad715901e300003030000000000100006402"
          expect_ack:
            - ""
          nsq_check:
            - $template: nsq_connection_info_connect
              args: ["${imei}"]
            - $template: nsq_data
              args: ["${imei}", "00000000000000678e01000001997b9d3788003f8ccc90fc4a2de7001c01060d004300000010000800ef0100f0010015050001010071640107012a38012a4400000500426dc300430fcb0044000001470c0a2a480c1c000300f10000c742001001ad715901e300003030000000000100006402", "fmb130", "teltonika"]

        - name: Command reply message
          send: "00000000000000990c010600000091436f6465205665723a30312e32372e3237205265763a302044657669636520494d45493a333532303934303839353139303138204465766963652049443a30303030313920426f6f746c6f61646572205665723a30312e3139204d6f64656d20415050205665723a544d3235515f525f30312e30302e30312e30305f3030332c20323031372f30392f32352031303a343401000083cd"
          expect_ack: []
          nsq_check:
            - $template: nsq_data
              args: ["${imei}", "00000000000000990c010600000091436f6465205665723a30312e32372e3237205265763a302044657669636520494d45493a333532303934303839353139303138204465766963652049443a30303030313920426f6f746c6f61646572205665723a30312e3139204d6f64656d20415050205665723a544d3235515f525f30312e30302e30312e30305f3030332c20323031372f30392f32352031303a343401000083cd", "fmb130", "teltonika"]
            - $template: nsq_data
              args: ["${imei}", "00000000000000260c01050000001e737563636573732120636f6d6d616e642073656e74202d20676574766572010000ee8a", "fmb130", "teltonika"]
              expected_failed: true   # cause running paralel with login, we dont know wich one received by gate

      - steps:
        - delay: 2
        - name: Send online command
          pre_test:
            - $template: reset_command_queue
              args: ["${imei}"]
          send: "80800${imei}0753544154555323"
          expect_ack: []
          db_check:
            - $template: db_check_command_queue
              args: ["${imei}", false]